<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
<ui:composition template="/template/escolar/template-alumno.xhtml">
    <ui:define name="hamburguesa">
        <div class="color-nav uk-visible@m">
            <div class="uk-position-top-center nave-superior"><h:graphicImage library="img" name="alumno/control-superior.svg" class="" alt="" width="250" height="auto"/></div>
        </div>
        <div class="color-nav uk-hidden@m">
            <nav class="uk-navbar-container uk-navbar-transparent" uk-navbar="">
                <div class="">
                    <a class="logo uk-logo" href="#">
                        <h:graphicImage  library="img" name="esquadron.svg"  alt="logo" title="logo" width="30px" height="30px" />
                        <span class="lescuadron letra-logo uk-visible@m">squadron</span>
                    </a>
                </div>
                <div class="uk-navbar-right ">
                    <a class="uk-navbar-toggle" uk-navbar-toggle-icon="" href="" uk-toggle="target: #menu" type="button"/>
                </div>
                <div id="menu" uk-offcanvas="overlay: true">
                    <div class="uk-offcanvas-bar  ">
                        <button class="uk-offcanvas-close" type="button" uk-close=""/>
                        <ul class="uk-thumbnav uk-thumbnav-vertical uk-position-top-center uk-margin-large-top">
                            <li uk-tooltip="title: #{alumno['for.all.views.dashboard']}; pos: right"><h:link outcome="dashboard"><h:graphicImage library="img" name="alumno/planetas/tierra.svg" width="40" alt=""/></h:link></li>
                            <li uk-tooltip="title: #{alumno['for.all.views.activity']}; pos: right" class="uk-active"><h:link outcome="actividades"><h:graphicImage library="img" name="alumno/planetas/planeta1.svg" width="40" alt="" /></h:link></li>
                            <li uk-tooltip="title: #{alumno['for.all.views.glossary']}; pos: right"><h:link outcome="glosario"><h:graphicImage library="img" name="alumno/planetas/planeta2.svg" width="40" alt="" /></h:link></li>
                            <li uk-tooltip="title: Indefinido; pos: right"><h:link outcome="more-activity"><h:graphicImage library="img" name="alumno/planetas/planeta3.svg"  width="40" alt="" /></h:link></li>
                            <li uk-tooltip="title: #{alumno['for.all.views.mind.map']}; pos: right"><h:link outcome="mapa-mental"><h:graphicImage library="img" name="alumno/planetas/planeta4.svg" width="40" height="" alt="" /></h:link></li>
                            <li uk-tooltip="title: #{alumno['for.all.views.library']}; pos: right"><h:link outcome="biblioteca-alumno"><h:graphicImage library="img" name="alumno/planetas/planeta5.svg" width="40" alt="" /></h:link></li>
                        </ul>

                    </div>
                </div>
            </nav>
            <div class="barra-nav"></div>
        </div>
    </ui:define>
    <ui:define name="menu">
        <div class="left-content-box  content-box-dark">
            <h:graphicImage library="img" name="avatar/astronauta-nino.svg" alt="" class="uk-border-circle profile-img" rendered="#{true}"/>
            <h:graphicImage library="img" name="avatar/astronauta-nina.svg" alt="" class="uk-border-circle profile-img" rendered="#{false}"/>
            <h6 class="uk-text-center uk-margin-remove-vertical text-light nombre-usuario">#{alumnoControlador.alumnoModelo.apodo}</h6>
            <div class="uk-position-relative uk-text-center uk-display-block">
                <!--Modificar los datos para mostrar en el Alumno-->
                <a href="#" class="uk-text-small uk-text-muted uk-display-block uk-text-center uk-text-capitalize" data-uk-icon="icon: triangle-down; ratio: 0.7">#{etiqueta['menu']}</a>
                <!-- user dropdown -->
                <div class="uk-dropdown user-drop" data-uk-dropdown="mode: click; pos: bottom-center; animation: uk-animation-slide-bottom-small; duration: 150">
                    <ul >
                        <li><a href="#" class="uk-text-capitalize">#{alumno['for.all.views.profile']}</a></li>
                        <li><a href="#" class="uk-text-capitalize">#{etiqueta['close.sesion']}</a></li>
                    </ul>
                </div>
                <!-- /user dropdown -->
            </div>
        </div>
        <div class="left-nav-wrap  uk-visible@xl ">
            <ul class="uk-thumbnav uk-thumbnav-vertical uk-position-center uk-margin-large-top">
                <li uk-tooltip="title: #{alumno['for.all.views.dashboard']}; pos: right"><h:link outcome="dashboard"><h:graphicImage library="img" name="alumno/planetas/tierra.svg" width="80" alt=""/></h:link></li>
                <li uk-tooltip="title: #{alumno['for.all.views.activity']}; pos: right" class="uk-active"><h:link outcome="actividades"><h:graphicImage library="img" name="alumno/planetas/planeta1.svg" width="80" alt="" /></h:link></li>
                <li uk-tooltip="title: #{alumno['for.all.views.glossary']}; pos: right"><h:link outcome="glosario"><h:graphicImage library="img" name="alumno/planetas/planeta2.svg" width="80" alt="" /></h:link></li>
                <li uk-tooltip="title: Indefinido; pos: right"><h:link outcome="more-activity"><h:graphicImage library="img" name="alumno/planetas/planeta3.svg"  width="80" alt="" /></h:link></li>
                <li uk-tooltip="title: #{alumno['for.all.views.mind.map']}; pos: right"><h:link outcome="mapa-mental"><h:graphicImage library="img" name="alumno/planetas/planeta4.svg" width="80" height="" alt="" /></h:link></li>
                <li uk-tooltip="title: #{alumno['for.all.views.library']}; pos: right"><h:link outcome="biblioteca-alumno"><h:graphicImage library="img" name="alumno/planetas/planeta5.svg" width="80" alt="" /></h:link></li>
            </ul>
        </div>
        <div class="left-nav-wrap uk-position-relative  uk-hidden@xl ">
            <ul class="uk-thumbnav uk-thumbnav-vertical uk-position-top-center uk-margin-small-top">
                <li uk-tooltip="title: #{alumno['for.all.views.dashboard']}; pos: right"><h:link outcome="dashboard"><h:graphicImage library="img" name="alumno/planetas/tierra.svg" width="60" alt=""/></h:link></li>
                <li uk-tooltip="title: #{alumno['for.all.views.activity']}; pos: right" class="uk-active"><h:link outcome="actividades"><h:graphicImage library="img" name="alumno/planetas/planeta1.svg" width="60" alt=""/></h:link></li>
                <li uk-tooltip="title: #{alumno['for.all.views.glossary']}; pos: right"><h:link outcome="glosario"><h:graphicImage library="img" name="alumno/planetas/planeta2.svg" width="60" alt=""/></h:link></li>
                <li uk-tooltip="title: #{alumno['for.all.views.undefined']}Indefinido; pos: right"><h:link outcome="more-activity"><h:graphicImage library="img" name="alumno/planetas/planeta3.svg" width="60" alt=""/></h:link></li>
                <li uk-tooltip="title: #{alumno['for.all.views.mind.map']}; pos: right"><h:link outcome="mapa-mental"><h:graphicImage library="img" name="alumno/planetas/planeta4.svg" width="60" alt=""/></h:link></li>
                <li uk-tooltip="title: #{alumno['for.all.views.library']}; pos: right"><h:link outcome="biblioteca-alumno"><h:graphicImage library="img" name="alumno/planetas/planeta5.svg" width="60" alt=""/></h:link></li>
            </ul>
        </div>
    </ui:define>
    <ui:define name="contenido">
        <h:outputStylesheet library="css" name="alumno/transcript/transcript.css"/>
        <h:outputStylesheet library="css" name="/alumno/transcript/variables-alumno.css"/>
        <h:outputStylesheet library="css" name="/alumno/transcript/lista-ordenar.css"/>
        <h:outputStylesheet library="css" name="/alumno/transcript/ordenar-palabra.css"/>
        <h:outputStylesheet library="css" name="/alumno/transcript/transcript-drag.css"/>
        <h:outputStylesheet library="css" name="letra.css"/>
        <script src="https://www.youtube.com/iframe_api"></script>
        <div class="uk-section margen-superior" style="box-sizing: border-box">
            <div class="uk-container padding-contenedor">
                <h:panelGroup layout="block" id="filtro-seleccion" pt:uk-filter="target: .js-filter">
                    <ul class="uk-subnav uk-subnav-pill uk-flex uk-flex-center "  >
                        <li uk-filter-control=".transcrip" uk-tooltip="#{alumno['activities.bar.icon.video']}" class="uk-active uk-animation-toggle" tabindex="0" data-respuesta="#{empty alumnoControlador.tareaActividadModelo.respuesta ? 'vacio' : 'lleno'}" data-respondiendo="#{alumnoControlador.tareaActividadModelo.resolviendoTranscript}">
                            <h:graphicImage library="img" name="mounstro/morado.svg" width="70" height="70"  alt="" styleClass="uk-border-circle uk-animation-shake"/>
                        </li>
                        <li uk-filter-control=".match" uk-tooltip="#{alumno['activities.bar.icon.match']}" class="uk-animation-toggle" tabindex="0" style="display: #{empty relacionarOracionControlador.tareaRelacionarOracionModeloLista ? 'none' : 'block'}">
                            <h:graphicImage library="img" name="mounstro/naranja.svg" width="70" height="70" styleClass="uk-border-circle uk-animation-shake"/>
                        </li>
                        <li uk-filter-control=".order-words" uk-tooltip="#{alumno['activities.title.order.words']}" class="uk-animation-toggle" tabindex="0" style="display: #{empty gramaticaControlador.gramaticaModeloLista ? 'none' : 'block'}">
                            <h:graphicImage library="img" name="mounstro/3ojos.svg" width="70" height="70" styleClass="uk-border-circle uk-animation-shake"/>
                        </li>
                        <li uk-filter-control=".answer" uk-tooltip="#{alumno['activities.bar.icon.transcript']}" class="uk-animation-toggle" tabindex="0">
                            <h:graphicImage library="img" name="mounstro/verde.svg" width="70" height="70" styleClass="uk-border-circle uk-animation-shake"/>
                        </li>
                        <h:form>
                            <h:inputHidden value="#{transcripcionControlador.activo}"/>
                            <h:commandLink style="display: none">
                                <f:ajax execute="@form" listener="#{transcripcionControlador.cambiaEstatus}" render="@none"/>
                            </h:commandLink>
                        </h:form>
                    </ul>

                    <ul class="js-filter  uk-text-center" >
                        <li class="transcrip">
                           <h:panelGroup layout="block" styleClass="uk-grid" pt:uk-grid="">
                               <div class="uk-width-1-2@m tam-contenido uk-padding-remove-left">
                                   <div data-video="#{alumnoControlador.tareaActividadModelo.idActividad}" class="scrollFinal"></div>
                               </div>
                               <div id="scrollTranscript" class="uk-width-1-2@m uk-text-justify transcrip-contenedor tam-contenido scroll-alumno letra-guion borde-guion transcripcion">
                                   <h:outputText value="#{actividadAlumnoControlador.transcripcion}" escape="false"/>
                               </div>
                           </h:panelGroup>
                        </li>
                        <li class="match uk-margin-small-top ">
                            <h:form id="formulario-relacionar">
                                <h:panelGroup layout="block" styleClass="caja-preguntas-ordenar uk-grid scroll-drag" pt:uk-grid="">
                                    <div class="uk-width-1-2@m uk-position-relative">
                                        <div class="titulo-respuesta-ordenar " >#{alumno['activities.title.match.sentence.question']}</div>
                                        <ui:repeat value="#{relacionarOracionControlador.tareaRelacionarOracionModeloLista}" var="relacionarOracion">
                                            <div class="pregunta-ordenar">
                                                #{relacionarOracion.relacionarOracionModelo.pregunta}
                                            </div>
                                        </ui:repeat>
                                        <h:graphicImage library="img" name="/mounstro/who.svg" styleClass="img-titulo-1"/>
                                    </div>
                                    <div class="uk-width-1-2@m uk-position-relative">
                                        <div class="titulo-respuesta-ordenar">#{alumno['activities.title.match.sentence.answer']}</div>
                                        <ui:repeat value="#{relacionarOracionControlador.tareaRelacionarOracionModeloLista}" var="relacionarOracion" varStatus="cont">
                                            <h:panelGroup  id="cont#{cont.index}" layout="block" styleClass="respuestas-ordenar-lista" pt:ondrop="drop(event, this)" pt:ondragover="allowDrop(event)" >
                                                <h:panelGroup layout="block" rendered="#{not empty relacionarOracionControlador.tareaRelacionarOracionModeloLista[cont.index].respuesta}" styleClass="respuesta">
                                                    #{relacionarOracionControlador.respuestaVal(relacionarOracionControlador.tareaRelacionarOracionModeloLista[cont.index].respuesta)}
                                                </h:panelGroup>
                                            </h:panelGroup>
                                        </ui:repeat>
                                        <h:graphicImage library="img" name="/mounstro/whom.svg" styleClass="img-titulo-2"/>
                                    </div>
                                </h:panelGroup>
                                <h:panelGroup id="tablaRespuestas"
                                              layout="block"
                                              styleClass="respuestas-ordenar scroll-drag"
                                              pt:ondrop="drop(event, this)"
                                              pt:ondragover="allowDrop(event)" rendered="#{empty relacionarOracionControlador.tareaRelacionarOracionModeloLista[0].respuesta}">
                                    <ui:repeat value="#{relacionarOracionControlador.desordenaLista(relacionarOracionControlador.tareaRelacionarOracionModeloLista)}" var="preRespuestas" varStatus="resp">
                                        <h:panelGroup id="resp#{resp.index}"
                                                      layout="block"
                                                      styleClass="respuesta"
                                                      pt:data-id="#{preRespuestas.relacionarOracionModelo.id}"
                                                      pt:draggable="true"
                                                      pt:ondragstart="drag(event)"
                                                      pt:ondrop="return false"
                                                      pt:ondragover="return false">
                                            #{preRespuestas.relacionarOracionModelo.respuesta}
                                        </h:panelGroup>
                                    </ui:repeat>
                                </h:panelGroup>
                                <h:graphicImage library="img" styleClass="movimiento2 finalizado2" name="/alumno/pop-art/boton-finished.svg" rendered="#{not empty relacionarOracionControlador.tareaRelacionarOracionModeloLista[0].respuesta}"/>
                                <h:inputHidden id="respuestaOraciones" value="#{relacionarOracionControlador.idRespuesta}"/>
                                <h:commandButton id="buttonEnviar" styleClass="boton-enviar boton-trasladar" style="" onclick="recuperaDatos()" value="Send" rendered="#{empty relacionarOracionControlador.tareaRelacionarOracionModeloLista[0].respuesta}">
                                    <f:ajax listener="#{relacionarOracionControlador.llenarTareaModelo()}" execute="@form" render="@form"/>
                                </h:commandButton>
                            </h:form>
                        </li>
                        <li class="order-words">
                            <h1 class="uk-text-center lescuadron" style="color: white">Ordena las palabras en el orden correspondiente</h1>
                            <div class="imagen-ordenar">
                                <h:graphicImage library="img" name="mounstro/whom.svg"/>
                            </div>
                            <ul class="uk-subnav uk-subnav-pill uk-flex uk-flex-center menu-ordenar " uk-switcher="">
                                <ui:repeat value="#{gramaticaControlador.gramaticaModeloLista}" var="gramatica" varStatus="estatus">
                                    <li class="#{empty gramatica.respuesta ? 'boton-falta' : 'boton-listo'}">#{estatus.index + 1}</li>
                                </ui:repeat>
                            </ul>
                            <ul class="uk-switcher uk-margin">
                                <ui:repeat value="#{gramaticaControlador.gramaticaModeloLista}" var="gramatica">
                                    <li>
<!--                                        <h:panelGroup layout="block" styleClass="realizado movimiento" rendered="#{not empty gramatica.respuesta}">-->
<!--                                                <span>Respondido</span>-->
<!--                                        </h:panelGroup>-->
                                        <h:graphicImage library="img" styleClass="movimiento finalizado1" name="/alumno/pop-art/boton-finished.svg" rendered="#{not empty gramatica.respuesta}"/>
                                        <h:form>
                                            <h:panelGroup layout="block" styleClass="uk-container padding-contenedor estilo-contenedor">
                                                <h:inputHidden value="#{empty gramatica.respuesta ? gramatica.palabra : gramatica.respuesta}" pt:data-respuesta="#{empty gramatica.respuesta}"/>
                                                <h:panelGroup layout="block" styleClass="uk-child-width-1-5@m uk-grid  uk-padding-small" pt:uk-grid="" pt:uk-sortable="" rendered="#{empty gramatica.respuesta}"/>
                                                <h:panelGroup layout="block" styleClass="uk-child-width-1-5@m uk-grid  uk-padding-small" pt:uk-grid="" rendered="#{not empty gramatica.respuesta}"/>
                                            </h:panelGroup>
                                            <h:inputHidden value="#{tareaGramaticaControlador.respuesta}"/>
                                            <h:commandButton value="Send" styleClass="boton-enviar boton-trasladar" onclick="completarPalabra(this)" rendered="#{empty gramatica.respuesta}">
                                                <f:ajax listener="#{tareaGramaticaControlador.enviarRespuesta(gramatica.codigo, gramatica.actividadModelo.idVideo)}"
                                                        execute="@form" onevent="function funcion(data) { remueveOrdenador(data) }"/>
                                            </h:commandButton>
                                        </h:form>
                                    </li>
                                </ui:repeat>
                            </ul>
                        </li>
                        <li class="answer">
                            <div class="video-activity">
                                <div data-video="#{alumnoControlador.tareaActividadModelo.idActividad}" class="scrollFinal"></div>
                            </div>
                            <h:panelGroup layout="block" styleClass="uk-child-width-1-2@m uk-grid" pt:uk-grid="">
                                <h:panelGroup layout="block" styleClass="contenedor-padre-activity" rendered="#{empty alumnoControlador.tareaActividadModelo.respuesta}">
                                    <h:panelGroup layout="block" styleClass="uk-sortable contenedor-respuesta" pt:uk-sortable="group: respuesta"/>
                                </h:panelGroup>
                                <div class="trancript-contenedor arrastrar scroll-drag uk-text-justify remplazar" data-respuesta="#{empty alumnoControlador.tareaActividadModelo.respuesta}">
                                    <h:outputText value="#{actividadAlumnoControlador.transcripcion}" escape="false" rendered="#{empty alumnoControlador.tareaActividadModelo.respuesta}"/>
                                    <h:outputText value="#{alumnoControlador.tareaActividadModelo.respuesta}" escape="false" rendered="#{not empty alumnoControlador.tareaActividadModelo.respuesta}"/>
                                </div>
                                <h:graphicImage library="img" styleClass="movimiento1 finalizado" name="/alumno/pop-art/boton-finished.svg" rendered="#{not empty alumnoControlador.tareaActividadModelo.respuesta}"/>
<!--                                <h:outputText styleClass="realizado movimiento1" value="Respondido" rendered="#{not empty alumnoControlador.tareaActividadModelo.respuesta}"/>-->
                            </h:panelGroup>
                            <h:form>
                                <h:inputHidden value="#{transcripcionControlador.transcripcion}"/>
                                <h:commandButton styleClass="boton-enviar boton-trasladar" style="margin-top: 20px" value="Send" onclick="return validaContenido()" rendered="#{empty alumnoControlador.tareaActividadModelo.respuesta}">
                                    <f:ajax listener="#{transcripcionControlador.enviaRespuestas}" execute="@form" onevent="function funcion(data) { transcripcionEnvidad(data); }"/>
                                </h:commandButton>
                            </h:form>
                        </li>
                    </ul>
                </h:panelGroup>
            </div>
        </div>
        <script type="application/javascript">
            var videoPlayer = document.querySelectorAll('.scrollFinal');
            var player;
            var totalRespuestasTranscripcion = 0;
            var ordenarPalabras = document.querySelector('.order-words');

            function onYouTubeIframeAPIReady() {
                videoPlayer.forEach(function (video) {
                    console.log(video.dataset.video);
                    player = new YT.Player( video, {
                        height: '100%',
                        width: '100%',
                        videoId: video.dataset.video,
                        events: {
                            'onReady': onPlayerReady,
                            'onStateChange': onPlayerStateChange
                        }
                    });
                });
            }

            function onPlayerReady(event) {
                console.log(event, 'Evento Listo!!');
            }

            var done = false;
            function onPlayerStateChange(event) {
                if (event.data === YT.PlayerState.PLAYING &amp;&amp; !done) {
                    console.log('Ocurrio el evento! ');
                    pageScroll();
                    done = true;
                }else {
                    done = false;
                }
            }
            function pageScroll() {
                var objDiv = document.getElementById('scrollTranscript');
                objDiv.scrollTop = objDiv.scrollTop + 1;
                time = setTimeout('pageScroll()', 500);
            }
        </script>
        <script type="text/javascript">
            document.querySelectorAll('.estilo-contenedor input[type=hidden]').forEach(function (palabra) {
                subPalabra = palabra.value.split(" ");
                if (palabra.dataset.respuesta === 'true') {
                    subPalabra = revolver(subPalabra);
                }
                subPalabra.forEach(function (value1) {
                    if (value1.trim() !== '') {
                        padre = document.createElement('div');
                        hijo = document.createElement('div');
                        hijo.classList.add('palabra','uk-text-center');
                        hijo.appendChild(document.createTextNode(value1.replace('.','')));
                        padre.appendChild(hijo);
                        palabra.nextElementSibling.appendChild(padre);
                    }
                });
            });

            function revolver(arreglo) {
                var indiceActual = arreglo.length, temporal, indiceAleatorio;
                while (0 !== indiceActual) {
                    indiceAleatorio = Math.floor(Math.random() * indiceActual);
                    indiceActual -= 1;
                    temporal = arreglo[indiceActual];
                    arreglo[indiceActual] = arreglo[indiceAleatorio];
                    arreglo[indiceAleatorio] = temporal;
                }
                return arreglo;
            }
            
            function completarPalabra(elemento) {
                var texto = elemento.previousElementSibling.previousElementSibling.querySelectorAll('div > div > .palabra');
                var respuesta = '';
                texto.forEach(function (value) {
                    respuesta = respuesta.concat(value.textContent).concat(' ');
                });
                elemento.previousElementSibling.value = respuesta.trim();
            }

            function remueveOrdenador(data) {
                if (data.status === 'success') {
                    data.source.previousElementSibling.previousElementSibling.querySelector('.uk-sortable').removeAttribute('uk-sortable');
                    data.source.disabled = true;
                    UIkit.notification("Respuesta Enviada correctamente", {pos: 'top-right'});
                    var cambio = ordenarPalabras.querySelector('ul li.uk-active');
                    cambio.classList.remove('boton-falta');
                    cambio.classList.add('boton-listo');
                    var div = document.createElement('div');
                    div.classList.add('realizado', 'movimiento');
                    var responder = document.createElement('span');
                    responder.textContent = "Responder";
                    div.appendChild(responder);
                    data.source.parentElement.parentElement.appendChild(div);
                }
            }

            function recuperaDatos() {
                var idRelacionarmodelos = document.querySelectorAll('.match form > div:nth-child(2) > div:nth-child(2) > div:not(:first-child)');
                var getId = [];
                idRelacionarmodelos.forEach(function (input) {
                    getId.push(input.querySelector('div').dataset.id);
                });
                document.getElementById('formulario-relacionar:respuestaOraciones').value = getId.join();
                document.querySelector('input[type=submit]').disabled = true;
            }

            document.addEventListener('DOMContentLoaded', estaResuelto);
            function estaResuelto() {
                if (document.querySelector('.match').getAttribute('value') === 'true'){
                    var boton = document.getElementById('formulario-relacionar:buttonEnviar');
                    var tabla = document.getElementById('formulario-relacionar:tablaRespuestas');
                    boton.style.display = 'none';
                    tabla.style.display = 'none';
                }
            }
        </script>
        <h:outputScript library="js" name="alumno/transcripcion.js"/>
        <h:outputScript library="js" name="alumno/activity.js"/>
        <h:outputScript library="js" name="/alumno/drag-drop.js"/>
    </ui:define>
</ui:composition>
</html>