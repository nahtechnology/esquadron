<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
<ui:composition template="/template/escolar/template-alumno.xhtml">
    <ui:define name="hamburguesa">
        <div class="color-nav uk-visible@m">
            <div class="uk-position-top-center nave-superior"><h:graphicImage library="img" name="alumno/control-superior.svg" class="" alt="" width="250" height="auto"/></div>
        </div>
        <div class="color-nav uk-hidden@m">
            <nav class="uk-navbar-container uk-navbar-transparent" uk-navbar="">
                <div class="">
                    <a class="logo uk-logo" href="#">
                        <h:graphicImage  library="img" name="esquadron.svg"  alt="logo" title="logo" width="30px" height="30px" />
                        <span class="lescuadron letra-logo uk-visible@m">squadron</span>
                    </a>
                </div>
                <div class="uk-navbar-right ">
                    <a class="uk-navbar-toggle" uk-navbar-toggle-icon="" href="" uk-toggle="target: #menu" type="button"/>
                </div>
                <div id="menu" uk-offcanvas="overlay: true">
                    <div class="uk-offcanvas-bar  ">
                        <button class="uk-offcanvas-close" type="button" uk-close=""/>
                        <ul class="uk-thumbnav uk-thumbnav-vertical uk-position-top-center uk-margin-large-top">
                            <li uk-tooltip="title: #{alumno['dashboard']}; pos: right" class="uk-active uk-text-capitalize"><h:link outcome="dashboard" ><h:graphicImage library="img" name="alumno/planetas/tierra.svg" width="40" alt=""/></h:link></li>
                            <li uk-tooltip="title: #{alumno['activity']}; pos: right"><h:graphicImage library="img" name="alumno/planetas/planeta1.svg" width="40" alt="" /></li>
                            <li uk-tooltip="title: #{alumno['library']}; pos: right"><h:link outcome="biblioteca-alumno"><h:graphicImage library="img" name="alumno/planetas/planeta5.svg"  width="40" alt="" /></h:link></li>
                        </ul>

                    </div>
                </div>
            </nav>
            <div class="barra-nav"></div>
        </div>
    </ui:define>
    <ui:define name="menu">
        <div class="left-content-box  content-box-dark">
            <h:graphicImage library="img" name="avatar/astronauta-nino.svg" alt="" class="uk-border-circle profile-img" rendered="#{true}"/>
            <h:graphicImage library="img" name="avatar/astronauta-nina.svg" alt="" class="uk-border-circle profile-img" rendered="#{false}"/>
            <h6 class="uk-text-center uk-margin-remove-vertical text-light nombre-usuario">#{alumnoControlador.alumnoModelo.apodo}</h6>

            <div class="uk-position-relative uk-text-center uk-display-block">
                <a href="#" class="uk-text-small uk-text-muted uk-display-block uk-text-center uk-text-capitalize" data-uk-icon="icon: triangle-down; ratio: 0.7">#{etiqueta['menu']}</a>
                <!-- user dropdown -->
                <div class="uk-dropdown user-drop" data-uk-dropdown="mode: click; pos: bottom-center; animation: uk-animation-slide-bottom-small; duration: 150">
                    <ul>
                        <li><a href="#" class="uk-text-capitalize">#{alumno['profile']}</a></li>
                        <li><a href="#" class="uk-text-capitalize">#{etiqueta['close.sesion']}</a></li>
                    </ul>
                </div>
                <!-- /user dropdown -->
            </div>
        </div>

        <div class="left-nav-wrap  uk-visible@xl ">
            <ul class="uk-thumbnav uk-thumbnav-vertical uk-position-center uk-margin-large-top">
                <li uk-tooltip="title: #{alumno['dashboard']}; pos: right"><h:link outcome="dashboard"><h:graphicImage library="img" name="alumno/planetas/tierra.svg" width="80" alt=""/></h:link></li>
                <li uk-tooltip="title: #{alumno['activity']}; pos: right" class="uk-active" ><h:graphicImage library="img" name="alumno/planetas/planeta1.svg" width="80" alt="" /></li>
                <li uk-tooltip="title: #{alumno['library']}; pos: right"><h:link outcome="biblioteca-alumno"><h:graphicImage library="img" name="alumno/planetas/planeta5.svg"  width="80" alt="" /></h:link></li>
            </ul>
        </div>
        <div class="left-nav-wrap uk-position-relative  uk-hidden@xl ">
            <ul class="uk-thumbnav uk-thumbnav-vertical uk-position-top-center uk-margin-small-top">
                <li uk-tooltip="title: #{alumno['dashboard']}; pos: right" ><h:link outcome="dashboard" ><h:graphicImage library="img" name="alumno/planetas/tierra.svg"  width="60" alt=""/></h:link></li>
                <li uk-tooltip="title: #{alumno['activity']}; pos: right" class="uk-active"><h:graphicImage library="img" name="alumno/planetas/planeta1.svg"  width="60" alt=""/></li>
                <li uk-tooltip="title: #{alumno['library']}; pos: right"><h:link outcome="biblioteca-alumno"><h:graphicImage library="img" name="alumno/planetas/planeta5.svg"  width="60" alt=""/></h:link></li>
            </ul>
        </div>
    </ui:define>
    <ui:define name="contenido">
        <h:outputStylesheet library="css" name="navegacion.css"/>
        <h:outputStylesheet library="css" name="biblioteca.css"/>
        <script src="https://www.youtube.com/iframe_api"></script>

        <div class="uk-container  margen-superior  padding-inferior">
            <div data-uk-filter="target: .js-filter">
                <h:panelGroup layout="block" styleClass="uk-grid js-filter uk-margin-medium-top uk-margin-large-bottom" pt:uk-grid="">
                    <ui:repeat value="#{alumnoControlador.tareaActvidadModeloLista}" var="tareaActvidadModelo">
                        <h:panelGroup layout="block" styleClass="uk-width-1-3@m " pt:data-tags="a beautiful landscape - nature outdoor">
                            <div class="uk-card uk-card-default uk-card-small uk-card-hover card-border ">
                                <div class="uk-card-header border-card">
                                    <h:panelGroup layout="block" styleClass="uk-grid uk-grid-small uk-text-small" pt:uk-grid="">
                                        <div class="uk-width-expand">
                                            <h:graphicImage styleClass="uk-border-circle" library="img" name="mounstro/3ojos.svg" width="30" height="30" />
                                            <span class="cat-txt">
                                                <h:outputText value="#{tareaActvidadModelo.asignacion}">
                                                    <f:convertDateTime locale="en_UK" timeStyle="short" type="both" dateStyle="full"/>
                                                </h:outputText>
                                                #{tareaActvidadModelo.idActividad}
                                            </span>
                                        </div>
                                        <div class="uk-width-auto uk-text-right uk-text-muted">
                                            <h:outputText styleClass="uk-margin-small-right" pt:uk-icon="icon:clock"/>
                                            <span class="uk-padding-small">#{tareaActvidadModelo.reproducciones}</span>
                                        </div>
                                    </h:panelGroup>
                                </div>
                                <div class="uk-card-media-top">
                                    <h:panelGroup layout="block" pt:uk-spinner=""/>
                                        <div id="#{tareaActvidadModelo.idActividad}" class="videoPlayer"></div>
                                </div>
                                <div style="" class="uk-card-body">
                                    <div class="uk-text-center mensaje1"><span class="mensaje1-1">#{alumno['title.description.please.watch.the']}<br/>#{alumno['title.description.full.video']}</span></div>
                                </div>
                                <div style="" class="uk-card-footer">
                                    <h:form>
                                        <h:commandLink  action="#{tareaGramaticaControlador.incrementaReporduccion(1, tareaActvidadModelo.id)}" style="display: none">
                                            <f:actionListener binding="#{actividadAlumno2Controlador.buscaPregunta(tareaActvidadModelo.idActividad)}"/>
                                            <f:ajax render="pregunta-detonadora"/>
                                        </h:commandLink>
                                    </h:form>
                                    <h:form styleClass="tam-form">
                                        <h:commandButton styleClass="boton" action="#{alumnoControlador.seleccion(tareaActvidadModelo)}" value="#{boton['homework']}"/>
                                    </h:form>
                                </div>
                            </div>
                        </h:panelGroup>
                    </ui:repeat>
                </h:panelGroup>
            </div>
        </div>
        <h:panelGroup id="modal-pregunta-detonadora" layout="block" styleClass="uk-flex-top fondo-pregunta-detonadora" pt:uk-modal="">
            <div class="uk-modal-dialog pop-art-modal uk-modal-body uk-margin-auto-vertical">
                <button class="uk-modal-close-default" type="button" uk-close=""/>
                <h:outputText id="pregunta-detonadora" value="#{actividadAlumno2Controlador.preguntaDetonadora}"/>
            </div>
        </h:panelGroup>
        <script type="application/javascript">
            var videos = document.querySelectorAll('.videoPlayer');
            var mensajes = document.querySelectorAll('.uk-card-body');
            var reproducciones = document.querySelectorAll('.uk-padding-small');
            var linksTareas = document.querySelectorAll('.uk-card-footer');
            var i = 0;
            linksTareas.forEach(function (value) {
                value.dataset.id = videos[i].getAttribute('id');
                value.setAttribute('style',  (parseInt(reproducciones[i].innerHTML) !== 0)?'':'display: none;');
                mensajes[i].setAttribute('style', (parseInt(reproducciones[i].innerHTML) !== 0)?'display: none;':'');
                i++;
            });
            var players = [];
            var player;
            function onYouTubeIframeAPIReady() {
                videos.forEach(function (value) {
                    player = new YT.Player(value, {
                        height: '100%',
                        width: '100%',
                        videoId: value.getAttribute('id'),
                        events: {
                            'onReady': onPlayerReady,
                            'onStateChange': onPlayerStateChange
                        }
                    });
                    players.push(player);
                });
            }

            function onPlayerReady(event) {
                console.log('Reproductor listo.')
            }
            var done = false;
            function onPlayerStateChange(event) {
                if (event.data === YT.PlayerState.ENDED &amp;&amp; !done) {
                    var urlVideoYT = event.target.getVideoUrl();
                    var idVideoYT = urlVideoYT.split('v=');
                    var i = 0;
                    linksTareas.forEach(function (value) {
                        if(value.getAttribute('data-id') === idVideoYT[1]){
                            console.log(value, mensajes[i], idVideoYT[1]);
                            value.setAttribute('style', '');
                            mensajes[i].setAttribute('style', 'display: none;');
                        }
                        i++;
                    });
                    event.target.a.parentElement.nextElementSibling.nextElementSibling.querySelector('form a').click();
                    var reproducciones = event.target.a.parentElement.previousElementSibling.querySelector('span.uk-padding-small');
                    reproducciones.textContent = parseInt(reproducciones.textContent) + 1;
                    UIkit.modal(document.getElementById('modal-pregunta-detonadora')).show();
                    done = true;
                }else {
                    done = false;
                }
            }
        </script>
        <h:outputScript library="js" name="alumno/activities.js"/>
    </ui:define>
</ui:composition>
</html>
