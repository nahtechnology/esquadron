<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="/template/administracion/dashboard.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:pa="http://xmlns.jcp.org/jsf/composite/paginacion">
    <ui:define name="menu">
        <f:metadata>
            <f:viewParam name="profesor" value="#{reporteSesionControlador.idProfesor}"/>
            <f:viewParam name="alumno" value="#{reporteSesionControlador.idAlumno}"/>
            <f:viewAction action="#{reporteSesionControlador.inicio}"/>
        </f:metadata>
        <ul class="uk-nav uk-nav-default uk-nav-parent-icon" uk-nav="">
            <li class="uk-nav-header">#{coordinador['menu.menu']}</li>
            <li class="uk-parent uk-open">
                <a><h:graphicImage library="img" name="icono/escuela.svg" styleClass="uk-icon uk-icon-image uk-margin-small-right" pt:uk-svg=""/><span class="uk-text-capitalize">#{administracion['menu.schools']}</span></a>
                <h:panelGroup layout="block" rendered="#{reporteSesionControlador.idProfesor eq null}">
                    <ul class="uk-nav-sub">
                        <li class="uk-active"><h:link outcome="dashboard"><h:outputText pt:uk-icon="home" styleClass="uk-margin-small-right"/><span class="uk-text-capitalize">#{administracion['menu.dashboard']}</span></h:link></li>
                        <li class="uk-active"><a onclick="atras()"><h:outputText pt:uk-icon="file-edit" styleClass="uk-margin-small-right"/><span class="uk-text-capitalize">#{coordinador['menu.detail']}</span></a></li>
                        <li class="uk-active"><a><h:outputText pt:uk-icon="file-text" styleClass="uk-margin-small-right"/><span class="uk-text-capitalize">#{coordinador['menu.report']}</span></a></li>
                    </ul>
                </h:panelGroup>
                <h:panelGroup layout="block" rendered="#{reporteSesionControlador.idProfesor ne null}">
                    <ul class="uk-nav-sub">
                        <li class="uk-active"><h:link outcome="dashboard"><h:outputText pt:uk-icon="home" styleClass="uk-margin-small-right"/><span class="uk-text-capitalize">#{administracion['menu.dashboard']}</span></h:link></li>
                        <li class="uk-active"><a><h:outputText pt:uk-icon="file-text" styleClass="uk-margin-small-right"/><span class="uk-text-capitalize">#{coordinador['menu.report']}</span></a></li>
                    </ul>
                </h:panelGroup>
            </li>
        </ul>
    </ui:define>
    <ui:define name="contenido">
        <h:outputStylesheet library="css" name="/coordinador/template-coordinador.css"/>
        <h:outputStylesheet library="css" name="datepicker.css"/>
        <h:outputStylesheet library="css" name="/coordinador/reporte-sesion.css"/>
            <h1 class="uk-margin-medium-bottom">reporte sesion</h1>
            <h:form id="formulario-fechas">
                <div id="rango-fecha">
                    <h:inputText styleClass="uk-input" value="#{reporteSesionControlador.fechaInicio}">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </h:inputText>
                    <span>#{coordinador['report.sesion.to']}</span>
                    <h:inputText styleClass="uk-input" value="#{reporteSesionControlador.fechaFin}">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </h:inputText>
                </div>
                <ui:remove>
                <h:commandButton value="${boton['update']}" styleClass="uk-button uk-button-primary uk-margin-small-top uk-margin-medium-bottom" >
                    <f:ajax execute="@form"
                            listener="#{reporteSesionControlador.actualiza}"
                            render="contenedor-tabla tabla-alumno tabla-profesor tabla-vacia"
                            onevent="function pintar(data) {
                                if (data.status === 'success'){
                                    console.log('entro satisfactorio');
                                }
                            }"
                            />
                </h:commandButton>
                </ui:remove>
                <h:commandButton value="${boton['update']}" styleClass="uk-button uk-button-primary uk-margin-small-top uk-margin-medium-bottom" onclick="return validarFecha();">
                    <f:ajax execute="@form"
                            listener="#{reporteSesionControlador.actualiza}"
                            render="contenedor-tabla tabla-alumno tabla-profesor"
                            onevent="function pintar(data) {
                                if (data.status === 'success'){
                                    console.log('entro satisfactorio');
                                     let tabla = document.querySelector('#contenedor-tabla  table');
                                        if (tabla.dataset.vacio === 'false'){
                                            acomodarTabla(tabla);
                                             actualiza();
                                        }
                                }
                            }"
                            />
                </h:commandButton>
            </h:form>
        <span class="uk-margin-small-bottom uk-display-inline-block">
            <label for="conexion" class="uk-form-label uk-margin-small-right">#{coordinador['report.sesion.connection.time']}</label>
            <input id="conexion" readonly="" type="text" class="uk-input uk-margin-small-right" style="width: 200px"/>
            <label for="totalHoras" class="uk-form-label uk-margin-small-right">#{coordinador['report.sesion.total.hours']}</label>
            <input type="text" id="totalHoras" class="uk-input" style="width: 200px" />
        </span>
        <h:panelGroup layout="block" id="contenedor-tabla" styleClass="uk-margin-medium-bottom">
            <h:dataTable id="tabla-alumno"
                         rendered="#{not empty reporteSesionControlador.listaAlumno}"
                         styleClass="uk-table uk-table-hover uk-table-divider"
                         value="#{reporteSesionControlador.listaAlumno}"
                         var="alumnoModelo"
                         pt:data-vacio="false">
                <h:column>
                    <h:outputText value="${alumnoModelo.momento}">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </h:outputText>
                </h:column>
                <h:column>
                    <h:outputText value="${alumnoModelo.momento}">
                        <f:convertDateTime pattern="HH:mm:ss"/>
                    </h:outputText>
                </h:column>
            </h:dataTable>

            <h:dataTable id="tabla-profesor"
                         rendered="#{not empty reporteSesionControlador.listaProfesor}"
                         styleClass="uk-table uk-table-hover uk-table-divider"
                         value="#{reporteSesionControlador.listaProfesor}"
                         var="profesorModelo"
                         pt:data-vacio="false">

                    <h:column>
                        <h:outputText value="${profesorModelo.momento}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </h:column>
                    <h:column>
                        <h:outputText value="${profesorModelo.momento}">
                            <f:convertDateTime pattern="HH:mm:ss"/>
                        </h:outputText>
                    </h:column>

            </h:dataTable>

            <h:panelGroup layout="block" id="tabla-vacia" rendered="#{empty reporteSesionControlador.listaAlumno and empty reporteSesionControlador.listaProfesor}" >
                <table class="uk-table uk-table-hover uk-table-divider" data-vacio="true">
                    <thead>
                    <tr>
                        <th>#{coordinador['report.sesion.table.date']}</th>
                        <th>#{coordinador['report.sesion.table.start']}</th>
                        <th>#{coordinador['report.sesion.table.date']}</th>
                        <th>#{coordinador['report.sesion.table.end']}</th>
                        <th>#{coordinador['report.sesion.table.time']}</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td colspan="5" >
                            <h:graphicImage library="img" name="vacio.svg"/>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </h:panelGroup>
        </h:panelGroup>
    </ui:define>
    <ui:define name="file-js">
        <h:outputScript library="js" name="datepicker-full.js"/>
        <script >
            let datePicker = document.querySelector('#rango-fecha');
            let rango = new DateRangePicker(datePicker,{
                format:"dd/mm/yyyy"
            });
            function atras() {
                window.history.back();
            }
        </script>
        <h:outputScript library="js" name="/coordinador/reporte-sesion.js"/>
        <h:outputScript library="js" name="/coordinador/tiempo-total.js"/>
    </ui:define>
</ui:composition>